#!/usr/bin/env bash
set -euo pipefail

# ▣ [1] 공통 설정
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TMP_DIR="$SCRIPT_DIR/tmp/$(basename "$0" .sh)"
rm -rf "$TMP_DIR"
mkdir -p "$TMP_DIR"

source "$SCRIPT_DIR/utils.sh"

echo
echo "========================"
echo "$(basename "$0") Start"
echo "========================"
echo

# ▣ [2] 헤더
cat <<'B'
========================================
 레슨 18) 정규표현식 집중 연습(2): 한국 주민/전화/날짜 패턴
========================================
B

echo "[목표]"
echo "- 한국 주민등록번호 패턴을 이해하고 정규표현식으로 매칭한다."
echo "- 한국 전화번호 패턴을 이해하고 정규표현식으로 매칭한다."
echo "- 일반적인 날짜 패턴을 이해하고 정규표현식으로 매칭한다."
echo "- grep -o 옵션을 사용하여 매칭된 부분만 추출한다."
echo "- 정규표현식의 유연성과 한계를 다시 한번 확인한다."
echo

# ------------------------------------------------------------
echo "1️⃣  테스트용 한국 데이터 파일 생성"
KOREAN_DATA_FILE="$TMP_DIR/korean_data.txt"
cat > "$KOREAN_DATA_FILE" <<'DATA'
홍길동의 주민등록번호는 901225-1234567 입니다.
김철수의 전화번호는 010-1234-5678 이고, 사무실은 02-987-6543 입니다.
이메일: test@example.com
생년월일: 1988년 05월 15일. 계약일: 2023-11-21. 만료일: 2025/12/31.
유효하지 않은 주민번호: 901225-123456, 901225-12345678, 901225-5234567
유효하지 않은 전화번호: 01012345678, 02-123-456, 070-123-45678
다른 날짜: 2023.11.21, 2023년11월21일
DATA

echo "데이터 파일 생성: $KOREAN_DATA_FILE"
echo "--------------------------------"
nl -ba "$KOREAN_DATA_FILE"
echo "--------------------------------"
f_pause

# ------------------------------------------------------------
echo "2️⃣  한국 주민등록번호 패턴 매칭 및 추출"
echo "--- 주민등록번호 정규표현식 설명 (간소화) ---"
echo " - \b : 단어 경계 (정확한 숫자 매칭을 위해)"
echo " - [0-9]{6} : 생년월일 6자리"
echo " - - : 하이픈"
echo " - [1-4] : 성별/세기 구분 (1,2: 1900년대, 3,4: 2000년대)"
echo " - [0-9]{6} : 나머지 6자리"
echo " - \b : 단어 경계"
echo " (참고: 실제 주민등록번호 유효성 검사는 더 복잡합니다.)"
echo
echo "실행: grep -E -o '\b[0-9]{6}-[1-4][0-9]{6}\b' \"$KOREAN_DATA_FILE\""
grep -E -o '\b[0-9]{6}-[1-4][0-9]{6}\b' "$KOREAN_DATA_FILE"
f_pause

# ------------------------------------------------------------
echo "3️⃣  한국 전화번호 패턴 매칭 및 추출"
echo "--- 전화번호 정규표현식 설명 ---"
echo " - \b : 단어 경계"
echo " - 01[0-9] : 휴대폰 앞자리 (010, 011 등)"
echo " - | : 또는"
echo " - 0[2-9][0-9]? : 지역번호 (02, 031, 051 등)"
echo " - -? : 하이픈 (0회 또는 1회)"
echo " - [0-9]{3,4} : 중간 3~4자리"
echo " - -? : 하이픈 (0회 또는 1회)"
echo " - [0-9]{4} : 끝 4자리"
echo " - \b : 단어 경계"
echo
echo "실행: grep -E -o '\b(01[0-9]|0[2-9][0-9]?)-?[0-9]{3,4}-?[0-9]{4}\b' \"$KOREAN_DATA_FILE\""
grep -E -o '\b(01[0-9]|0[2-9][0-9]?)-?[0-9]{3,4}-?[0-9]{4}\b' "$KOREAN_DATA_FILE"
f_pause

# ------------------------------------------------------------
echo "4️⃣  날짜 패턴 매칭 및 추출"
echo "--- 날짜 정규표현식 설명 (YYYY-MM-DD 또는 YYYY/MM/DD) ---"
echo " - \b : 단어 경계"
echo " - [0-9]{4} : 연도 4자리"
echo " - [-/] : 하이픈 또는 슬래시"
echo " - [0-9]{2} : 월 2자리"
echo " - [-/] : 하이픈 또는 슬래시"
echo " - [0-9]{2} : 일 2자리"
echo " - \b : 단어 경계"
echo
echo "실행: grep -E -o '\b[0-9]{4}[-/][0-9]{2}[-/][0-9]{2}\b' \"$KOREAN_DATA_FILE\""
grep -E -o '\b[0-9]{4}[-/][0-9]{2}[-/][0-9]{2}\b' "$KOREAN_DATA_FILE"
f_pause

# 테스트용 데이터 삭제 여부 
f_delete_tmp

# ------------------------------------------------------------
echo "✅  레슨 18 완료!"
echo "특정 국가나 지역의 데이터 패턴을 정규표현식으로 추출하는 방법을 연습했습니다."
echo "실제 데이터는 더 복잡할 수 있으므로, 패턴을 계속해서 개선해야 합니다."

echo
echo "========================"
echo "$(basename "$0") End"
echo "========================"